<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Self Puzzle</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: black;
            color: white;
            text-align: center;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }

        h1 {
            color: #ff00ff;
            text-shadow: 0 0 20px #ff00ff;
            margin-bottom: 10px;
        }

        .upload-btn {
            background-color: #00aaff;
            color: white;
            padding: 10px 20px;
            font-size: 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-bottom: 20px;
            box-shadow: 0 0 20px #00aaff;
            transition: 0.3s;
        }

        .upload-btn:hover {
            background-color: #0088cc;
        }

        #timer {
            color: #00ff00;
            font-size: 24px;
            margin-bottom: 10px;
            text-shadow: 0 0 10px #00ff00;
        }

        #game-board {
            width: 300px;
            height: 300px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 2px;
            border: 4px solid #00ffff;
            box-shadow: 0 0 30px #00ffff;
            background-color: black;
            position: relative;
        }

        .tile {
            width: 100px;
            height: 100px;
            background-size: 300px 300px;
            cursor: pointer;
            transition: 0.3s;
            box-shadow: 0 0 10px #ff00ff;
            border-radius: 5px;
        }

        .empty {
            background-color: black;
            box-shadow: none;
            border: none;
            cursor: default;
        }

        #message {
            color: #ff00ff;
            font-size: 20px;
            text-shadow: 0 0 10px #ff00ff;
            margin-top: 20px;
        }
    </style>
</head>
<body>

<h1>SELF PUZZLE</h1>

<input type="file" id="fileInput" accept="image/*" class="upload-btn" />
<div id="timer">01:00</div>
<div id="game-board"></div>
<div id="message"></div>

<audio id="move-sound" src="https://www.fesliyanstudios.com/play-mp3/387" preload="auto"></audio>
<audio id="bg-music" src="https://www.fesliyanstudios.com/play-mp3/6568" preload="auto" loop></audio>

<script>
    const gameBoard = document.getElementById("game-board");
    const timerDisplay = document.getElementById("timer");
    const messageDisplay = document.getElementById("message");
    const moveSound = document.getElementById("move-sound");
    const bgMusic = document.getElementById("bg-music");

    let tiles = [];
    let emptyTile = { x: 2, y: 2 };
    let timeLeft = 60;
    let timer;

    document.getElementById("fileInput").addEventListener("change", handleImage);

    function handleImage(event) {
        const file = event.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = function (e) {
            createPuzzle(e.target.result);
            startGame();
        };
        reader.readAsDataURL(file);
    }

    function createPuzzle(imageSrc) {
        gameBoard.innerHTML = "";
        tiles = [];

        for (let i = 0; i < 9; i++) {
            const tile = document.createElement("div");
            tile.classList.add("tile");
            if (i !== 8) {
                tile.style.backgroundImage = `url(${imageSrc})`;
                tile.style.backgroundPosition = `-${(i % 3) * 100}px -${Math.floor(i / 3) * 100}px`;
                tile.dataset.index = i;
                tile.addEventListener("click", () => moveTile(i));
            } else {
                tile.classList.add("empty");
                emptyTile = { x: i % 3, y: Math.floor(i / 3) };
            }

            tiles.push(tile);
            gameBoard.appendChild(tile);
        }

        shuffleTiles();
    }

    function shuffleTiles() {
        for (let i = 0; i < 100; i++) {
            const moves = getPossibleMoves();
            const move = moves[Math.floor(Math.random() * moves.length)];
            swapTiles(move.x, move.y);
        }
    }

    function getPossibleMoves() {
        const moves = [];
        if (emptyTile.x > 0) moves.push({ x: emptyTile.x - 1, y: emptyTile.y });
        if (emptyTile.x < 2) moves.push({ x: emptyTile.x + 1, y: emptyTile.y });
        if (emptyTile.y > 0) moves.push({ x: emptyTile.x, y: emptyTile.y - 1 });
        if (emptyTile.y < 2) moves.push({ x: emptyTile.x, y: emptyTile.y + 1 });
        return moves;
    }

    function swapTiles(x, y) {
        const targetIndex = y * 3 + x;
        const emptyIndex = emptyTile.y * 3 + emptyTile.x;

        [tiles[targetIndex], tiles[emptyIndex]] = [tiles[emptyIndex], tiles[targetIndex]];
        emptyTile = { x, y };

        renderTiles();
    }

    function renderTiles() {
        tiles.forEach((tile, index) => {
            gameBoard.appendChild(tile);
            if (!tile.classList.contains("empty")) {
                tile.style.transform = `translate(${(index % 3) * 100}px, ${Math.floor(index / 3) * 100}px)`;
            }
        });
    }

    function moveTile(index) {
        const x = index % 3;
        const y = Math.floor(index / 3);

        if (
            (Math.abs(x - emptyTile.x) === 1 && y === emptyTile.y) ||
            (Math.abs(y - emptyTile.y) === 1 && x === emptyTile.x)
        ) {
            swapTiles(x, y);
            moveSound.play();

            if (isSolved()) {
                clearInterval(timer);
                messageDisplay.innerHTML = "YOU WIN! ðŸŽ‰";
            }
        }
    }

    function isSolved() {
        return tiles.every((tile, index) => tile.dataset.index == index || tile.classList.contains("empty"));
    }

    function startGame() {
        timeLeft = 60;
        clearInterval(timer);
        timer = setInterval(() => {
            timeLeft--;
            timerDisplay.innerText = `00:${timeLeft < 10 ? "0" + timeLeft : timeLeft}`;
            if (timeLeft === 0) {
                clearInterval(timer);
                messageDisplay.innerText = "TIME'S UP! ðŸ˜­";
            }
        }, 1000);

        bgMusic.play();
    }
</script>
</body>
</html>
